name: Tauri Release
description: A reusable action to publish a Tauri app.

inputs:
  github_token:
    description: 'GitHub token for authentication'
    required: true
  tag_name:
    description: 'The tag name for the release'
    required: true
    type: string
  body:
    description: 'The release body'
    required: true
    type: string
  id:
    description: 'The release ID'
    required: true
    type: string
  draft:
    description: 'Is this a draft release?'
    required: true
    type: boolean
  prerelease:
    description: 'Is this a prerelease?'
    required: true
    type: boolean

runs:
  using: 'composite'
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: lts/*

    - name: Install Rust stable
      uses: dtolnay/rust-toolchain@stable
      with:
        targets: 'aarch64-apple-darwin,x86_64-apple-darwin'

    - name: Install dependencies (Ubuntu only)
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        sudo apt-get install -y libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf

    - name: Install frontend dependencies
      run: npm install

    - name: Build and Publish Tauri App
      uses: tauri-apps/tauri-action@v0
      env:
        GITHUB_TOKEN: ${{ inputs.github_token }}
        TAURI_SIGNING_PRIVATE_KEY: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY }}
        TAURI_SIGNING_PRIVATE_KEY_PASSWORD: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY_PASSWORD }}
      with:
        tagName: ${{ inputs.tag_name }}
        releaseName: 'App v${{ inputs.tag_name }}'
        releaseBody: ${{ inputs.body }}
        releaseId: ${{ inputs.id }}
        releaseDraft: ${{ inputs.draft }}
        prerelease: ${{ inputs.prerelease }}
